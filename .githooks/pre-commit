#!/usr/bin/env bash
set -euo pipefail

PATTERN='OPENAI_API_KEY\s*[:=]\s*sk-[A-Za-z0-9]{20,}|ghp_[A-Za-z0-9]{20,}|github_pat_[A-Za-z0-9_]{20,}'

# checa apenas o que estÃ¡ staged
if git diff --cached -U0 --no-color | rg -n -S "$PATTERN" >/dev/null; then
  echo "FAIL: secret-like pattern detected in staged diff."
  echo "Keep secrets only in /root/.clawdbot/env (600)."
  exit 1
fi

echo "PASS: no secrets in staged diff."
